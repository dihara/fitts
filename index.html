<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Fitts's Law experiment</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(640, 640, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });

var text;
var counter = 0;
var circles = [];
var startButton, restartButton;
var distances = [100, 200, 300];

function preload() {
    game.load.spritesheet('button', 'assets/button_sprite_sheet.png', 193, 71);
    game.load.image('circleA', 'assets/greencircle.png');
    game.load.image('circleB', 'assets/redcircle.png');
}

/* Distribute whatever sprite objects are on circles[]
following a circular pattern */
function distributeCircles(radius) {
    var width = 640, height = 640,
        angle = 0, step = (2*Math.PI) / circles.length;
    var i;
    for (i=0; i<circles.length; i++) {
        var sendtox = Math.round(width/2 + radius * Math.cos(angle) - circles[i].width/2);
        var sendtoy = Math.round(height/2 + radius * Math.sin(angle) -  circles[i].height/2)
        if(window.console) {
            console.log(circles[i].key, sendtox, sendtoy);
        }
        game.add.tween(circles[i]).to( { centerY: sendtoy, centerX: sendtox }, 0, Phaser.Easing.Bounce.Out, true);
        angle += step;
    }
}

function create() {
    startButton = game.add.button(game.world.centerX - 95, 500, 'button', startButtonClick, this, 2, 1, 0);

    //button.onInputOver.add(over, button);
    //button.onInputOut.add(out, button);
    //button.onInputUp.add(up, button);
    
    text = game.add.text(250, 16, '', { fill: '#ffffff' });
}

function startButtonClick() {
    text.text = "Game start!!!";
    
    var i;
    for (i=0; i<10; i++) {
        var newcircle = game.add.sprite(game.world.centerX, game.world.centerY, 'circleA');
        newcircle.inputEnabled = true;     
        newcircle.events.onInputDown.add(listener, newcircle);
        newcircle.centerX = game.world.randomX;
        newcircle.centerY = game.world.randomY;
        circles.push(newcircle);
        //game.physics.enable([mycircle.sprite], Phaser.Physics.ARCADE);
    }
    distributeCircles(200);
    
    
    startButton.kill();
    
    restartButton = game.add.button(5, 5, 'button', restartButtonClick, this, 2, 1, 0);
}

function restartButtonClick() {
      distributeCircles(distances[Math.round(Math.random() * 2)]);
      
  
}

function render () {

}

function listener () {
    counter++;
    text.text = "You clicked " + this.key + " " + counter + " times!";
    
    if (this.key == 'circleA') {
      this.loadTexture('circleB', 0);
    } else {
      this.loadTexture('circleA', 0);
    }
}


function update() {

}

</script>

</body>
</html>